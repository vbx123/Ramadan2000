<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مواقيت الصلاة</title>
    <link rel="stylesheet" href="theme.css">
    <style>
        .prayer-header {
            text-align: center;
            padding: 30px 20px;
            background: var(--card);
            margin: 15px;
            border-radius: 20px;
            border-bottom: 5px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .location-text { color: var(--primary); font-weight: bold; font-size: 18px; margin-bottom: 5px; }
        .date-text { color: var(--muted); font-size: 14px; }

        /* حاوية الأوقات - عرض طولي */
        .times-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .time-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--card);
            border-radius: 15px;
            border-bottom: 3px solid var(--primary);
            transition: var(--transition);
            animation: cardAppear 0.5s ease backwards;
            box-shadow: var(--shadow);
        }

        /* وميض خاص بالصلاة القادمة */
        .next-prayer {
            border: 2px solid var(--primary);
            box-shadow: 0 0 15px var(--glow-color);
            transform: scale(1.02);
        }

        .prayer-name { font-size: 20px; font-weight: bold; color: var(--text); }
        .prayer-time { font-size: 22px; font-weight: bold; color: var(--primary); font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="icon-btn" onclick="window.history.back()">→</button>
        <div class="top-title">مواقيت الصلاة</div>
        <div style="width: 40px;"></div>
    </div>

    <div class="prayer-header">
        <div class="location-text" id="city">جاري تحديد الموقع...</div>
        <div class="date-text" id="date">-- --- ----</div>
    </div>

    <div class="times-container" id="prayerTimes">
        </div>

    <script>
        window.onload = getLocation;

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById('city').textContent = "الموقع غير مدعوم";
                fetchByCity("Cairo"); // الافتراضي
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            fetchTimes(lat, lng);
        }

        function showError() {
            document.getElementById('city').textContent = "القاهرة (افتراضي)";
            fetchByCity("Cairo");
        }

        async function fetchTimes(lat, lng) {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=4`);
                const data = await res.json();
                displayTimes(data.data);
            } catch (e) { console.error("Error fetching times"); }
        }

        async function fetchByCity(city) {
            const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Egypt&method=4`);
            const data = await res.json();
            displayTimes(data.data);
        }

        function displayTimes(data) {
            const timings = data.timings;
            const date = data.date;
            
            document.getElementById('date').textContent = `${date.hijri.day} ${date.hijri.month.ar} ${date.hijri.year} هـ`;
            document.getElementById('city').textContent = data.meta.timezone.split('/')[1] || "موقعك الحالي";

            const prayerNames = {
                "Fajr": "الفجر",
                "Sunrise": "الشروق",
                "Dhuhr": "الظهر",
                "Asr": "العصر",
                "Maghrib": "المغرب",
                "Isha": "العشاء"
            };

            const container = document.getElementById('prayerTimes');
            container.innerHTML = Object.keys(prayerNames).map(key => `
                <div class="time-card">
                    <span class="prayer-name">${prayerNames[key]}</span>
                    <span class="prayer-time">${convertTo12h(timings[key])}</span>
                </div>
            `).join('');
        }

        function convertTo12h(time) {
            let [h, m] = time.split(':');
            let ampm = h >= 12 ? 'م' : 'ص';
            h = h % 12 || 12;
            return `${h}:${m} ${ampm}`;
        }
    </script>
</body>
</html>
