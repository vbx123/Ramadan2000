<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø²Ø§Ø¯ Ø±Ù…Ø¶Ø§Ù†</title>
  <link rel="stylesheet" href="theme.css">
</head>
<body>

<!-- ===== Top Bar ===== -->
<header class="top-bar">
  <button class="icon-btn" onclick="toggleTheme()">ğŸŒ—</button>
  <div class="top-title">Ø²Ø§Ø¯ Ø±Ù…Ø¶Ø§Ù†</div>
  <button class="icon-btn">ğŸ› ï¸</button>
</header>

<!-- ===== Page 1 ===== -->
<div id="categoriesPage" class="page active">
  <header class="main-header">
    <h1>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h1>
  </header>

  <div id="categoriesList" class="list"></div>
</div>

<!-- ===== Page 2 ===== -->
<div id="storiesPage" class="page">
  <button class="back-btn" onclick="showPage('categoriesPage')">â† Ø±Ø¬ÙˆØ¹</button>
  <header class="main-header">
    <h1 id="sectionTitle"></h1>
  </header>
  <div id="storiesList" class="list"></div>
</div>

<!-- ===== Page 3 ===== -->
<div id="storyPage" class="page">
  <button class="back-btn" onclick="showPage('storiesPage')">â† Ø±Ø¬ÙˆØ¹</button>
  <header class="main-header">
    <h1 id="storyTitle"></h1>
  </header>

  <div id="loading" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  <div id="storyContent" class="story-content"></div>

  <div class="nav-links">
    <button class="nav-btn" onclick="loadPreviousStory()">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
    <button class="nav-btn" onclick="showPage('storiesPage')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    <button class="nav-btn" onclick="loadNextStory()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
</div>

<script>
/* ===== Theme ===== */
function toggleTheme() {
  const body = document.body;
  if (body.getAttribute('data-theme') === 'light') {
    body.removeAttribute('data-theme');
    localStorage.setItem('theme', 'green');
  } else {
    body.setAttribute('data-theme', 'light');
    localStorage.setItem('theme', 'light');
  }
}

if (localStorage.getItem('theme') === 'light') {
  document.body.setAttribute('data-theme', 'light');
}

/* ===== App ===== */
const categoryData = {
  Prophets: { name: "Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", icon: "ğŸ•‹" },
  sahaba: { name: "Ù‚ØµØµ Ø§Ù„ØµØ­Ø§Ø¨Ø©", icon: "ğŸ§•" },
  lessons: { name: "Ù‚ØµØµ Ø§Ù„Ø¹Ø¨Ø±Ø©", icon: "ğŸŒ±" },
  quran: { name: "Ù‚ØµØµ Ø§Ù„Ù‚Ø±Ø¢Ù†", icon: "ğŸ“–" }
};

let appData = {
  currentStories: [],
  currentStoryIndex: -1
};

fetch('data/stories/categories.json')
  .then(r => r.json())
  .then(data => displayCategories(data));

function displayCategories(data) {
  const container = document.getElementById('categoriesList');
  Object.keys(categoryData).forEach(id => {
    if (!data[id]) return;
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <h3>${categoryData[id].icon} ${categoryData[id].name}</h3>
      <p style="color:var(--muted)">${data[id].length} Ù‚ØµØ©</p>
    `;
    div.onclick = () => showStories(id, data[id]);
    container.appendChild(div);
  });
}

function showStories(id, stories) {
  appData.currentStories = stories;
  document.getElementById('sectionTitle').textContent = categoryData[id].name;
  showPage('storiesPage');

  const container = document.getElementById('storiesList');
  container.innerHTML = '';
  stories.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<h3>ğŸ“„ ${s.title}</h3>`;
    div.onclick = () => loadStory(s.file, i);
    container.appendChild(div);
  });
}

function loadStory(file, index) {
  appData.currentStoryIndex = index;
  showPage('storyPage');
  document.getElementById('loading').classList.remove('hidden');
  document.getElementById('storyContent').innerHTML = '';

  fetch('data/stories/' + file)
    .then(r => r.json())
    .then(d => {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('storyTitle').textContent = d.title;
      d.content.forEach(p => {
        const el = document.createElement('p');
        el.textContent = p;
        document.getElementById('storyContent').appendChild(el);
      });
    });
}

function loadPreviousStory() {
  if (appData.currentStoryIndex > 0)
    loadStory(appData.currentStories[appData.currentStoryIndex - 1].file, appData.currentStoryIndex - 1);
}

function loadNextStory() {
  if (appData.currentStoryIndex < appData.currentStories.length - 1)
    loadStory(appData.currentStories[appData.currentStoryIndex + 1].file, appData.currentStoryIndex + 1);
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
</script>

</body>
    </html>
