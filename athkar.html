<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الأذكار</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #d4af37;
            --bg-white: #ffffff;
            --card-white: #f9f9f9;
            --text-dark: #2c3e50;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-white);
            color: var(--text-dark);
            min-height: 100vh;
            padding-top: 70px;
        }

        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 65px; background: #fff;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        .top-title { font-family: 'Amiri', serif; font-size: 22px; font-weight: bold; color: var(--text-dark); }
        .back-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-dark); }

        .athkar-list {
            display: flex; flex-direction: column;
            gap: 15px; padding: 15px; max-width: 700px; margin: 0 auto;
        }

        .zekr-card {
            background: var(--card-white);
            border-radius: 15px;
            padding: 25px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid #eee;
            border-bottom: 4px solid var(--primary-color); 
            box-shadow: var(--shadow);
        }

        .zekr-card:active { transform: scale(0.97); }
        .zekr-card.glow { box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); border-color: var(--primary-color); }

        .zekr-text {
            font-family: 'Amiri', serif; font-size: 22px; line-height: 1.8;
            display: block; text-align: center; margin-bottom: 20px;
        }

        .counter-container { display: flex; justify-content: center; }
        .ring { width: 60px; height: 60px; position: relative; }
        .ring svg { transform: rotate(-90deg); width: 60px; height: 60px; }
        .ring circle { fill: none; stroke-width: 5; stroke-linecap: round; transition: 0.4s; }
        .circle-bg { stroke: #e0e0e0; }
        .circle-bar { stroke: var(--primary-color); }
        .count-num { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; font-size: 18px; }

        .zekr-card.is-done { opacity: 0.6; background: #f0f0f0; border-bottom-color: #2ecc71; }

        /* ستايل المودال (فضل الحديث) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: 2000; align-items: center; justify-content: center;
            padding: 20px;
        }
        .modal-card {
            background: #fff; padding: 25px; border-radius: 20px; width: 100%; max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: pop 0.3s ease;
            border-top: 5px solid var(--primary-color);
        }
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-card h3 { color: var(--primary-color); margin-bottom: 10px; font-size: 18px; }
        .modal-card p { font-size: 16px; line-height: 1.6; color: var(--text-dark); margin-bottom: 20px; }
        .close-btn { width: 100%; padding: 12px; background: var(--primary-color); color: #fff; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }

        .hint { text-align: center; font-size: 11px; color: #999; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="back-btn" onclick="goBack()">→</button>
        <div class="top-title" id="titleText">الأذكار</div>
        <div style="width: 30px;"></div>
    </div>

    <div class="athkar-list" id="mainBox"></div>

    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <h3>فضل الذكر ومصدره</h3>
            <p id="modalContent"></p>
            <button class="close-btn" onclick="closeM()">فهمت</button>
        </div>
    </div>

    <script>
        let isMain = true;
        let pressTimer;

        window.onload = loadCats;

        function loadCats() {
            isMain = true;
            document.getElementById('titleText').textContent = "الأذكار";
            fetch('Data/Remember/Titles.json')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('mainBox').innerHTML = data.map(c => `
                        <div class="zekr-card" onclick="loadData('${c.id}', '${c.name}')" style="display:flex; align-items:center; gap:15px;">
                            <img src="${c.icon}" width="35">
                            <h3 style="font-size:18px">${c.name}</h3>
                        </div>
                    `).join('');
                });
        }

        function loadData(id, name) {
            isMain = false;
            document.getElementById('titleText').textContent = name;
            fetch(`Data/Remember/${id}.json`)
                .then(r => r.json())
                .then(data => {
                    const content = data.content || data;
                    document.getElementById('mainBox').innerHTML = content.map((z, i) => {
                        const c = 2 * Math.PI * 25;
                        return `
                        <div class="zekr-card" id="card-${i}" 
                             onclick="hit(${i}, ${z.count})"
                             onmousedown="startP('${z.source}')" onmouseup="endP()" 
                             ontouchstart="startP('${z.source}')" ontouchend="endP()"
                             oncontextmenu="event.preventDefault(); showM('${z.source}');">
                            <span class="zekr-text">${z.text}</span>
                            <div class="counter-container">
                                <div class="ring">
                                    <svg><circle class="circle-bg" cx="30" cy="30" r="25"/><circle class="circle-bar" id="bar-${i}" cx="30" cy="30" r="25" style="stroke-dasharray:${c}; stroke-dashoffset:${c}"/></svg>
                                    <div class="count-num" id="num-${i}">${z.count}</div>
                                </div>
                            </div>
                            <div class="hint">اضغط مطولاً للفضل</div>
                        </div>`;
                    }).join('');
                    window.scrollTo(0,0);
                });
        }

        // منطق العداد
        function hit(i, max) {
            const card = document.getElementById(`card-${i}`);
            let val = parseInt(card.getAttribute('data-v') || 0);
            if (val < max) {
                val++;
                card.setAttribute('data-v', val);
                card.classList.add('glow');
                setTimeout(() => card.classList.remove('glow'), 200);
                const c = 2 * Math.PI * 25;
                const off = c - (val / max) * c;
                document.getElementById(`bar-${i}`).style.strokeDashoffset = off;
                document.getElementById(`num-${i}`).textContent = (max - val) === 0 ? "✓" : (max - val);
                if (val === max) { card.classList.add('is-done'); if(navigator.vibrate) navigator.vibrate(30); }
            }
        }

        // منطق الضغط المطول
        function startP(txt) { pressTimer = setTimeout(() => showM(txt), 700); }
        function endP() { clearTimeout(pressTimer); }
        
        function showM(txt) {
            document.getElementById('modalContent').textContent = txt || "لا يوجد تفاصيل إضافية.";
            document.getElementById('modal').style.display = 'flex';
        }
        function closeM() { document.getElementById('modal').style.display = 'none'; }

        function goBack() {
            if (!isMain) loadCats();
            else window.history.back();
        }
    </script>
</body>
</html>
