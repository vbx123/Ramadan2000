<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>القصة</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&family=Amiri&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f2a24;
  --card:#163b33;
  --primary:#d4af37;
  --text:#ffffff;
  --muted:#cfd8d3;
}
body{
  margin:0;
  font-family:Cairo;
  background:var(--bg);
  color:var(--text);
}
.back{
  padding:12px;
  color:var(--muted);
  cursor:pointer;
}
header{
  text-align:center;
  padding:16px;
  color:var(--primary);
}
.content{
  padding:18px;
  font-family:Amiri;
  font-size:19px;
  line-height:1.9;
}
.content p{margin-bottom:14px}
.error{
  padding:20px;
  text-align:center;
  color:var(--muted);
  display:none;
}
.loading{
  text-align:center;
  padding:20px;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="back" onclick="history.back()">← رجوع</div>

<header>
  <h2 id="title"></h2>
</header>

<div class="loading" id="loading">جاري تحميل القصة...</div>

<div class="content" id="content"></div>

<div class="error" id="error">
تعذر الوصول للبيانات، الرجاء إعادة التشغيل<br>
وإذا استمرت المشكلة تواصل مع الإدارة
</div>

<script>
const params = new URLSearchParams(location.search);
const file = params.get("file");
const loadingEl = document.getElementById("loading");
const contentEl = document.getElementById("content");
const errorEl = document.getElementById("error");
const titleEl = document.getElementById("title");

// إخفاء جميع العناصر في البداية
loadingEl.style.display = "block";
contentEl.style.display = "none";
errorEl.style.display = "none";

if(!file){
  showError("لم يتم تحديد ملف القصة");
}else{
  // تحميل ملف القصة - المسار: data/stories/[file]
  const filePath = `data/stories/${file}`;
  console.log("محاولة تحميل:", filePath); // للتصحيح
  
  fetch(filePath)
    .then(r => {
      if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
      return r.json();
    })
    .then(data => {
      console.log("تم تحميل القصة:", data); // للتصحيح
      loadingEl.style.display = "none";
      contentEl.style.display = "block";
      
      titleEl.textContent = data.title || "قصة بدون عنوان";
      
      if (data.content && Array.isArray(data.content)) {
        data.content.forEach(text => {
          const p = document.createElement("p");
          p.textContent = text;
          contentEl.appendChild(p);
        });
      } else {
        const p = document.createElement("p");
        p.textContent = "المحتوى غير متوفر";
        contentEl.appendChild(p);
      }
    })
    .catch(err => {
      console.error("خطأ في التحميل:", err);
      showError(`تعذر تحميل القصة: ${file}<br>${err.message}`);
    });
}

function showError(message){
  loadingEl.style.display = "none";
  contentEl.style.display = "none";
  errorEl.innerHTML = message;
  errorEl.style.display = "block";
}
</script>

</body>
</html>
