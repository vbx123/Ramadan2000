<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>المكتبة الإسلامية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="theme.css">
    <style>
        /* تحسينات إضافية لصفحة القصص */
        .reading-area {
            padding: 5px 12px; /* المسافة الصغيرة التي طلبتها للحواف */
            transition: all 0.3s ease;
        }

        .story-card-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
        }

        /* ستايل مخصص لعنوان القصة داخل القراءة */
        .story-header-box {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--glow-color);
            border-radius: 15px;
        }

        /* لوحة الإعدادات السفلية */
        .settings-sheet {
            position: fixed; bottom: -100%; left: 0; right: 0;
            background: var(--card); padding: 25px;
            border-radius: 25px 25px 0 0; z-index: 3000;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .settings-sheet.open { bottom: 0; }
        
        .sheet-overlay {
            display:none; position:fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); z-index: 2500; backdrop-filter: blur(3px);
        }

        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; margin-bottom: 10px; font-weight: bold; color: var(--primary); }
        
        .font-slider { width: 100%; accent-color: var(--primary); }
        
        .paper-modes { display: flex; gap: 10px; margin-top: 10px; }
        .mode-btn { 
            flex: 1; padding: 10px; border-radius: 10px; border: 1px solid var(--primary);
            cursor: pointer; text-align: center; font-size: 12px;
        }
    </style>
</head>
<body class="fade-in">

    <div class="top-bar">
        <button class="icon-btn" onclick="goBackLogic()" id="backBtn">
            <i class="fa-solid fa-arrow-right"></i>
        </button>
        <div class="top-title" id="dynamicTitle">زاد رمضان</div>
        <button class="icon-btn" id="mainActionBtn" onclick="toggleTheme()">
            <i class="fa-solid fa-circle-half-stroke"></i>
        </button>
    </div>

    <div id="categoriesPage" class="page active" style="margin-top: 20px;">
        <div class="story-card-list" id="categoriesList">
            </div>
    </div>

    <div id="storiesPage" class="page" style="display:none;">
        <div style="padding: 15px;" id="storiesList"></div>
    </div>

    <div id="storyPage" class="page" style="display:none;">
        <div class="reading-area">
            <div class="story-header-box">
                <h1 id="storyTitle" style="font-family: var(--font-fancy); color: var(--primary);"></h1>
            </div>
            <div id="storyContent" class="text-content">
                </div>
            
            <div class="nav-links" style="display: flex; gap: 10px; margin: 30px 0;">
                <button class="qa-btn" style="flex:1" onclick="loadPreviousStory()"><i class="fa-solid fa-chevron-right"></i> السابقة</button>
                <button class="qa-btn" style="flex:1" onclick="loadNextStory()">التالية <i class="fa-solid fa-chevron-left"></i></button>
            </div>
        </div>
    </div>

    <div class="sheet-overlay" id="overlay" onclick="closeSettings()"></div>
    <div class="settings-sheet" id="readerSettings">
        <div style="width:40px; height:5px; background:#ccc; margin: 0 auto 20px; border-radius:10px;"></div>
        <div class="control-group">
            <label><i class="fa-solid fa-font"></i> حجم الخط</label>
            <input type="range" class="font-slider" min="18" max="34" value="22" oninput="changeFontSize(this.value)">
        </div>
        <div class="control-group">
            <label><i class="fa-solid fa-palette"></i> نمط الورقة</label>
            <div class="paper-modes">
                <div class="mode-btn" style="background:#f4ecd8; color:#5b4636" onclick="setPaper('#f4ecd8','#5b4636')">كلاسيك</div>
                <div class="mode-btn" style="background:#ffffff; color:#1a1a1a" onclick="setPaper('#ffffff','#1a1a1a')">أبيض</div>
                <div class="mode-btn" style="background:var(--card); color:var(--text)" onclick="setPaper('transparent','inherit')">تلقائي</div>
            </div>
        </div>
        <button class="qa-btn" style="width:100%; margin-top:10px;" onclick="closeSettings()">إغلاق</button>
    </div>

    <script>
        // مزامنة الثيم مع الرئيسية
        document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');

        const categoryNames = {
            "Prophets": { name: "قصص الأنبياء", icon: "fa-person-rays" },
            "sahaba": { name: "قصص الصحابة", icon: "fa-users-direct" },
            "lessons": { name: "عبر ومواعظ", icon: "fa-lightbulb" },
            "quran": { name: "قصص القرآن", icon: "fa-book-quran" }
        };

        let appData = { categories: {}, currentStories: [], currentStoryIndex: -1 };

        window.onload = () => {
            // محاكاة تحميل البيانات - استبدلها بـ fetch الفعلي لملفاتك
            appData.categories = {
                "Prophets": [ {title: "آدم عليه السلام", file: "adam.json"}, {title: "نوح عليه السلام", file: "noah.json"} ],
                "sahaba": [ {title: "أبو بكر الصديق", file: "abubakr.json"} ]
            };
            displayCategories();
        };

        function displayCategories() {
            const list = document.getElementById('categoriesList');
            list.innerHTML = Object.keys(categoryNames).map(key => `
                <div class="card" onclick="showStories('${key}')">
                    <i class="fa-solid ${categoryNames[key].icon} fa-2x" style="color:var(--primary); margin-bottom:10px;"></i>
                    <h3>${categoryNames[key].name}</h3>
                </div>
            `).join('');
        }

        function showStories(key) {
            appData.currentStories = appData.categories[key] || [];
            document.getElementById('dynamicTitle').textContent = categoryNames[key].name;
            const list = document.getElementById('storiesList');
            list.innerHTML = appData.currentStories.map((s, i) => `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center;" onclick="loadStory('${s.file}', ${i})">
                    <span style="font-weight:bold;">${s.title}</span>
                    <i class="fa-solid fa-chevron-left" style="font-size:12px; opacity:0.5;"></i>
                </div>
            `).join('');
            switchPage('storiesPage');
        }

        function loadStory(file, index) {
            appData.currentStoryIndex = index;
            const story = appData.currentStories[index];
            document.getElementById('storyTitle').textContent = story.title;
            document.getElementById('storyContent').innerHTML = "<p>جاري تحميل محتوى القصة... (هنا يتم الربط مع ملفات الـ JSON الخاصة بك)</p>";
            switchPage('storyPage');
        }

        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            
            const actionBtn = document.getElementById('mainActionBtn');
            if(id === 'storyPage') {
                actionBtn.innerHTML = '<i class="fa-solid fa-sliders"></i>';
                actionBtn.onclick = openSettings;
            } else {
                actionBtn.innerHTML = '<i class="fa-solid fa-circle-half-stroke"></i>';
                actionBtn.onclick = toggleTheme;
            }
        }

        function goBackLogic() {
            if(document.getElementById('storyPage').style.display === 'block') switchPage('storiesPage');
            else if(document.getElementById('storiesPage').style.display === 'block') {
                document.getElementById('dynamicTitle').textContent = "زاد رمضان";
                switchPage('categoriesPage');
            }
            else window.history.back();
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
        }

        // إعدادات القارئ
        function openSettings() {
            document.getElementById('readerSettings').classList.add('open');
            document.getElementById('overlay').style.display = 'block';
        }
        function closeSettings() {
            document.getElementById('readerSettings').classList.remove('open');
            document.getElementById('overlay').style.display = 'none';
        }
        function changeFontSize(v) {
            document.getElementById('storyContent').style.fontSize = v + 'px';
        }
        function setPaper(bg, color) {
            const area = document.querySelector('.reading-area');
            area.style.background = bg;
            area.style.color = color;
            document.getElementById('storyContent').style.color = color;
        }
    </script>
</body>
                    </html>
