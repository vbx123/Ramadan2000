<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ ÙˆØ§Ù„ØµØ­Ø§Ø¨Ø©</title>
    
    <link rel="stylesheet" href="theme.css">
    
    <style>
        /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø®Ø§ØµØ© ÙÙ‚Ø· Ø¨Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙØ­Ø§Øª (Page Logic) ÙˆÙ„ÙŠØ³Øª Ù„Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© */
        .page { display: none; min-height: 80vh; }
        .page.active { display: block; }
        .story-content { 
            font-family: var(--font-content); 
            font-size: 22px; 
            line-height: 1.8; 
            text-align: justify; 
            padding: 10px;
        }
        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 20px 0;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .error { color: #ff6b6b; text-align: center; padding: 20px; border: 1px dashed #ff6b6b; border-radius: 12px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="top-bar">
    <button class="icon-btn" onclick="goBackLogic()" id="backBtn">âœ•</button>
    <div class="top-title" id="dynamicTitle">Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</div>
    <button class="icon-btn" onclick="toggleTheme()">ğŸŒ“</button>
</div>

<div id="categoriesPage" class="page active">
    <header>
        <h1>ğŸ“– Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ ÙˆØ§Ù„ØµØ­Ø§Ø¨Ø©</h1>
        <p>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØµ</p>
    </header>
    
    <div id="categoriesList" class="container">
        </div>
    
    <div id="categoriesError" class="error hidden">âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
</div>

<div id="storiesPage" class="page">
    <header>
        <h1 id="sectionTitle">Ù‚ØµØµ Ø§Ù„Ù‚Ø³Ù…</h1>
    </header>
    
    <div id="storiesList" class="container" style="grid-template-columns: 1fr;">
        </div>
</div>

<div id="storyPage" class="page">
    <header>
        <h1 id="storyTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚ØµØ©</h1>
    </header>
    
    <div id="loading" style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    
    <div class="container" style="display:block;">
        <div id="storyContent" class="story-content"></div>
    </div>
    
    <div class="nav-links" style="padding: 16px;">
        <button class="card" style="flex:1; margin:5px;" onclick="loadPreviousStory()">Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
        <button class="card" style="flex:1; margin:5px;" onclick="loadNextStory()">Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
    </div>
</div>

<footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2024</footer>

<script>
    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø«ÙŠÙ… ÙˆØ§Ù„Ø­ÙØ¸ ---
    function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ---
    function goBackLogic() {
        if (document.getElementById('storyPage').classList.contains('active')) {
            showPage('storiesPage');
        } else if (document.getElementById('storiesPage').classList.contains('active')) {
            showPage('categoriesPage');
        } else {
            window.history.back(); // Ù„Ùˆ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙŠØ±Ø¬Ø¹ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        }
    }

    let appData = {
        currentCategory: null,
        currentStories: [],
        currentStoryIndex: -1,
        categories: {}
    };

    const categoryNames = {
        "Prophets": "Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡",
        "sahaba": "Ù‚ØµØµ Ø§Ù„ØµØ­Ø§Ø¨Ø©",
        "lessons": "Ù‚ØµØµ Ø§Ù„Ø¹Ø¨Ø±Ø©",
        "quran": "Ù‚ØµØµ Ø§Ù„Ù‚Ø±Ø¢Ù†"
    };

    window.addEventListener('DOMContentLoaded', loadCategories);

    function loadCategories() {
        fetch('data/stories/categories.json')
            .then(res => res.json())
            .then(data => {
                appData.categories = data;
                displayCategories();
            })
            .catch(() => document.getElementById('categoriesError').classList.remove('hidden'));
    }

    function displayCategories() {
        const container = document.getElementById('categoriesList');
        container.innerHTML = '';
        const order = ["Prophets", "sahaba", "lessons", "quran"];
        
        order.forEach(id => {
            if (appData.categories[id]) {
                const item = document.createElement('div');
                item.className = 'card';
                item.innerHTML = `
                    <h3>${categoryNames[id] || id}</h3>
                    <p>${appData.categories[id].length} Ù‚ØµØ©</p>
                `;
                item.onclick = () => showStories(id, appData.categories[id]);
                container.appendChild(item);
            }
        });
    }

    function showStories(categoryId, stories) {
        appData.currentStories = stories;
        document.getElementById('sectionTitle').textContent = categoryNames[categoryId] || categoryId;
        showPage('storiesPage');
        
        const container = document.getElementById('storiesList');
        container.innerHTML = '';
        
        stories.forEach((story, index) => {
            const el = document.createElement('div');
            el.className = 'surah-item'; // Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø§Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø³ÙˆØ± Ù„Ø£Ù†Ù‡ Ø£Ù†Ø³Ø¨ Ù„Ù„Ù‚ÙˆØ§Ø¦Ù…
            el.textContent = story.title;
            el.onclick = () => loadStory(story.file, index);
            container.appendChild(el);
        });
    }

    function loadStory(filePath, index) {
        appData.currentStoryIndex = index;
        showPage('storyPage');
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('storyContent').innerHTML = '';
        
        fetch(`data/stories/${filePath}`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('storyTitle').textContent = data.title;
                const contentDiv = document.getElementById('storyContent');
                data.content.forEach(para => {
                    const p = document.createElement('p');
                    p.textContent = para;
                    contentDiv.appendChild(p);
                });
            });
    }

    function loadNextStory() {
        if (appData.currentStoryIndex < appData.currentStories.length - 1) {
            const next = appData.currentStories[appData.currentStoryIndex + 1];
            loadStory(next.file, appData.currentStoryIndex + 1);
        }
    }

    function loadPreviousStory() {
        if (appData.currentStoryIndex > 0) {
            const prev = appData.currentStories[appData.currentStoryIndex - 1];
            loadStory(prev.file, appData.currentStoryIndex - 1);
        }
    }

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        // ØªØºÙŠÙŠØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
        document.getElementById('backBtn').textContent = pageId === 'categoriesPage' ? 'âœ•' : 'â†’';
        window.scrollTo(0,0);
    }
</script>

</body>
    </html>
